name: fullymodulardiscordbot

services:
  fullymodulardiscordbot:
    image: ghcr.io/yundera/nginx-hash-lock:latest
    restart: unless-stopped
    user: "root"
    privileged: true
    cap_add:
      - SYS_ADMIN
      - NET_ADMIN
    expose:
      - "80"
    environment:
      AUTH_HASH: $AUTH_HASH
      BACKEND_HOST: "fullymodulardiscordbotapp"
      BACKEND_PORT: "8080"
      LISTEN_PORT: "80"
      ALLOWED_EXTENSIONS: "js,jsx,css,png,ico,svg,jpg,jpeg,gif,woff,woff2,ttf,eot"
      ALLOWED_PATHS: "/guild,/auth"  # Exception for OAuth and Guild Web-UI (no AUTH_HASH required)
    depends_on:
      - fullymodulardiscordbotapp
    networks:
      - pcs

  redis:
    image: redis:7-alpine
    container_name: fullymodulardiscordbot_redis
    restart: unless-stopped
    networks:
      - pcs
    command: redis-server --save "" --loglevel warning
    volumes:
      - type: bind
        source: $DATA_ROOT/AppData/fullymodulardiscordbot/data/redis
        target: /data

  fullymodulardiscordbotapp:
    image: ghcr.io/krizcold/fully-modular-discord-bot:latest
    container_name: fullymodulardiscordbotapp
    restart: unless-stopped
    depends_on:
      - redis
    environment:
      DISCORD_TOKEN: ''
      GUILD_ID: ''
      CLIENT_ID: ''
      MAIN_GUILD_ID: ''
      DEVS: ''
      ENABLE_GUILD_WEBUI: ''
      DISCORD_CLIENT_ID: ''
      DISCORD_CLIENT_SECRET: ''
      OAUTH_CALLBACK_URL: ''
      SESSION_SECRET: ''
      REDIS_URL: ''
      APP_TOKEN: $API_HASH
      BOT_MANAGER_API: $BOT_MANAGER_API
    volumes:
      - type: bind
        source: $DATA_ROOT/AppData/fullymodulardiscordbot/smdb-source
        target: /app/smdb-source
      - type: bind
        source: $DATA_ROOT/AppData/fullymodulardiscordbot/data
        target: /data
    networks:
      - pcs
    expose:
      - 8080
    x-casaos:
      volumes:
        - container: /app/smdb-source
          description:
            en_us: Fully Modular Discord Bot source directory.
        - container: /data
          description:
            en_us: Persistent data directory for update configs and bot data.

x-casaos:
  architectures:
    - amd64
    - arm64
  main: fullymodulardiscordbot
  build: fullymodulardiscordbotapp
  author: kriz_cold
  developer: kriz_cold
  icon: https://cdn.statically.io/gh/krizcold/AppStore/main/Apps/Fully-Modular-Discord-Bot/icon.png
  tagline:
    en_us: "(Test) A flexible Discord bot framework with Web-UI"
  category: Chat
  description:
    en_us: "A fully modular Discord bot with web-based management dashboard. Configure and monitor your bot from anywhere."
  title:
    en_us: "Fully Modular Discord Bot"
  port_map: "80"
  index: /?hash=$AUTH_HASH
  webui_port: 80

networks:
  pcs:
    external: true
